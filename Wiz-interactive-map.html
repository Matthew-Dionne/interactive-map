<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Map</title>
    <style>
      #map {
        height: 100%;
        width: 100%;
      }
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
    <script>
      var map;

      function initMap() {
        document.addEventListener('DOMContentLoaded', function () {
          var mapDiv = document.getElementById('map');
          if (mapDiv) {
            map = new google.maps.Map(mapDiv, {
              center: { lat: 39.7392, lng: -104.9903 },
              zoom: 8
            });
          } else {
            console.error('Map div not found');
          }
        });
      }

      window.addEventListener("message", function(event) {
        try {
          var data = JSON.parse(event.data);
          if (Array.isArray(data) && map) {
            data.forEach(function(loc) {
              var marker = new google.maps.Marker({
                position: { lat: loc.latitude, lng: loc.longitude },
                map: map,
                title: loc.name
              });

              var infoWindow = new google.maps.InfoWindow({
                content: '<strong>' + loc.name + '</strong><br>' + loc.address
              });

              marker.addListener("click", function() {
                infoWindow.open(map, marker);
              });
            });
          }
        } catch (e) {
          console.error("Invalid data received:", e);
        }
      });
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9J_zCJMayc7-IY0tHz28uviJN_7DFuNY&callback=initMap"></script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
